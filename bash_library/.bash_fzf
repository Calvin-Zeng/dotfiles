# Check the fzf is present.
[ ! $(command -v fzf) ] && return 1

FZF_DEFAULT_OPTS="-m --ansi --preview '[ -f {} ] && bat --terminal-width $((COLUMNS)) --color \"always\" {} || tree -ifCL 2 {}' "
FZF_DEFAULT_OPTS+="--preview-window='up:80%:hidden' "
FZF_DEFAULT_OPTS+="--bind='"
# Ctrl + d - reload to the folder list
FZF_DEFAULT_OPTS+="ctrl-d:reload(find . -type d),"
FZF_DEFAULT_OPTS+="ctrl-f:reload(cat /tmp/fzf_list_$(date +"%Y-%m-%d")),"
FZF_DEFAULT_OPTS+="ctrl-h:reload(find /tmp/fzf_list_*),"
FZF_DEFAULT_OPTS+="ctrl-g:reload(cat {}),"
#  F3 - Toggle preview windows.
FZF_DEFAULT_OPTS+="f3:toggle-preview,"
#  F4 - open selected file in SublimeText.
[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ] && \
FZF_DEFAULT_OPTS+="f4:execute(vi {+})," \
|| \
[ $(command -v fzf) ] && FZF_DEFAULT_OPTS+="f4:execute(subl {+}),"
#  Ctrl + a - Toggle all matched.
FZF_DEFAULT_OPTS+="f8:execute(rm -ir {+}),"
#  Ctrl + a - Toggle all matched.
FZF_DEFAULT_OPTS+="ctrl-a:toggle-all,"
# preview control
# For Windows termial, like Xshell
FZF_DEFAULT_OPTS+="alt-left:preview-page-up,"
FZF_DEFAULT_OPTS+="alt-right:preview-page-down,"
# For Ubuntu
FZF_DEFAULT_OPTS+="shift-left:preview-page-up,"
FZF_DEFAULT_OPTS+="shift-right:preview-page-down,"
#  Ctrl + y - copy path to clipboard.
[ $(command -v xclip) ] && FZF_DEFAULT_OPTS+="ctrl-y:execute-silent(echo {+} | tr \"\n\" \"\0\" | xclip -selection clipboard),"
#  Ctrl + s - copy selected path to /tmp/fzf_list_
FZF_DEFAULT_OPTS+="ctrl-s:execute-silent(echo $(pwd)/{} | tr \" \" \"\n\" >> /tmp/fzf_list_$(date +"%Y-%m-%d")),"
#  Alt + s - Erase /tmp/fzf_list_
FZF_DEFAULT_OPTS+="alt-s:execute-silent(cat /dev/null > /tmp/fzf_list_$(date +"%Y-%m-%d"))"
FZF_DEFAULT_OPTS+="'"
export FZF_DEFAULT_OPTS

# Improved command
alias lsof_ipv4="lsof -Pn -i4 | awk '{printf \"%10s %6s %5s %4s %-20s\n\", \$1, \$2, \$3, \$8, \$9}' | fzf --border --cycle --ansi --header-lines=1"
alias service_list="cat /etc/services | fzf"

# fzf material
# --multi --height 40% --reverse --border
alias _FZF_H40='fzf --cycle --border --ansi --reverse --height 40%'
alias _FZF_H40_M='fzf --cycle --border --ansi --reverse -m --height 40%'
alias _FZF_H80='fzf --cycle --border --ansi --reverse --height 80%'
alias _FZF_H80_M='fzf --cycle --border --ansi --reverse -m --height 80%'

# TBD:fzf - change to vertical style.
alias previewfile="fzf -m --preview 'bat --terminal-width $((COLUMNS/2-5)) --color \"always\" {} '"
alias previewdir="fzf -m --preview 'ls --color=\"always\" -lshGg {} '"

treef () {
    cd $(find ./ -type d | fzf --preview " tree -C -L 3 {} ")
}

# Function
_FZF_H40_FileList () {
    cat "$@" | _FZF_H40
}

_FZF_H40_M_FileList () {
    cat "$@" | _FZF_H40_M
}

_FZF_H80_FileList () {
    cat "$@" | _FZF_H80
}

_FZF_H80_M_FileList () {
    cat "$@" | _FZF_H80_M
}

# Load the fzf custom command.
for fzf_file in $dotfiles_dir/bash_library/bash_fzf/.fzf_*; do
    # echo "Loading the $fzf_file"
    [ -f "$fzf_file" ] && [ -r "$fzf_file" ] && source "$fzf_file";
done;
unset fzf_file;
